another way to post this one with full control -- manual commit + transaction

@app.post("/courses")
@with_connection()
async def create_course(course: Course, conn):
    # Start an explicit transaction
    trx = conn.transaction()
    await trx.start()
    try:
        # Insert the course and return the ID
        row = await conn.fetchrow(
            """
            INSERT INTO courses (title, level, duration_minutes)
            VALUES ($1, $2, $3)
            RETURNING id
            """,
            course.title,
            course.level,
            course.duration_minutes
        )

        # Commit the transaction explicitly
        await trx.commit()
    except Exception as e:
        # Rollback if anything fails
        await trx.rollback()
        raise e

    return {"message": "Course created", "id": row["id"]}
    
async def get_course(course_id: int, conn):
    row = await conn.fetchrow(
        "SELECT id, title, level, duration_minutes FROM courses WHERE id = $1",
        course_id
    )
    if row is None:
        raise HTTPException(status_code=404, detail="Course not found")
    return dict(row)